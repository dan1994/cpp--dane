# Dan Encoding Exercise Requirements

This project is an exercise in creating a text encoder.

## Principle of Operation

- Create an executable that can:
	- Encode a textual file using a given coding scheme. The coding scheme can be either a:
		- Canonical scheme
		- Scheme generated from the text to encode
		- Scheme generated from other arbitrary text
	- Encoding may fail if:
		- The input file's alphabet is not contained in the requested coding scheme's alphabet.
		- The size of the an encoded letter surpasses a certain size
	- Decode an encoded file generated by this executable
	- Generate a coding scheme from a textual file to be used later

## Output File Format

This utility generates `.dane` (Dan encoding) binary files. The structure of these files is detailed in this chapter.

### DANE Header

This section is present in all `.dane` files in every version, and is located at the beginning of the file.

	-----------------------------------------------------------------
	|       0       |       1       |       2       |       3       |
	|---------------------------------------------------------------|
	|             magic             |    version    |    encoding   |
	|---------------------------------------------------------------|
	|            options            |            checksum           |
	-----------------------------------------------------------------

#### Field Description

- `magic` is the constant `0xdane`
- `version` is the file format version
- `encoding` is the type of encoding
	- At this point in time only huffman encoding is supported which is represented by the value 0
- `options` includes several bit fields. Supported options:
	- `encoding_only` is asserted if the file contains only an encoding without an encoded text. Located at bit 0.
- `checksum` is a checksum over the entire file
	- If the checksum is set to 0, then it should be ignored

### Encoding Section

The encoding section contains information about the encoding itself. This section is mandatory in all `.dane` files.

#### Version 1

	-----------------------------------------------------------------
	|       0       |       1       |       2       |       3       |
	|---------------------------------------------------------------|
	|         section_size          | alphabet_size |    reserved   |
	|---------------------------------------------------------------|
	|   letter[0]   |    size[0]    |          encoded[0] -         |
	|---------------------------------------------------------------|
	|          - encoded[0]         |   letter[1]   |    size[1]    |
	|---------------------------------------------------------------|
	|                           encoded[1]                          |
	|---------------------------------------------------------------|
	|                              ...                              |
	-----------------------------------------------------------------

##### Field description

- `section_size` holds the size of the section in bytes
- `alphabet_size` is the amount of letters that construct the encoding
- `letter[i]` is an alphabet letter
- `size[i]` is the size of the encoded letter
- `encoded[i]` is the representation of `letter[i]` according to the scheme

### Encoded Text Section

This section contains the encoded text itself. This section is present only if the `encoding_only` option in the DANE header is deasserted.

#### Version 1
	-----------------------------------------------------------------
	|       0       |       1       |       2       |       3       |
	|---------------------------------------------------------------|
	|    padding    |                encoded_text -                 |
	|---------------------------------------------------------------|
	|                              ...                              |
	|---------------------------------------------------------------|
	|                       - encoded_text                          |
	-----------------------------------------------------------------

##### Field Description

- `padding` is the amount of 'garbage' bits that are required to make `encoded_text` alligned to byte boundary
- `encoded_text` is the encoded text with padding located at its start

## ABI
- `dane -h`
	- Print usage information
- `dane [-c | -i encoding_file] -e text_file encoded_file`
	- Encode `text_file` and save the result in `encoded_file`
		- If `-c` is given use canonical encoding
		- If `-i` is given import the encoding from `encoding_file`
		- Else generate the encoding
- `dane -d encoded_text_file text_file`
	- Decode `encoded_text_file` and save the result in `text_file`
- `dane -g text_file encoding_file`
	- Extract the encoding from `text_file` and save the result in `encoding_file`
